# x-puzzle-stitcher 多端功能对比报告

本文档旨在梳理 **Chrome 扩展端** 与 **PWA (Web) 端** 在功能实现、数据获取及技术架构上的差异，方便后续的功能迭代与维护。

## 1. 核心定位对比

| 维度         | Chrome 扩展端 (Browser Extension)                 | PWA 端 (Web App)                                 |
| :----------- | :------------------------------------------------ | :----------------------------------------------- |
| **主要目标** | 深度集成于 Twitter (X) 网页，提供沉浸式操作体验。 | 提供跨平台的独立工具，无需安装插件，支持移动端。 |
| **入口点**   | 页面注入按钮、右键菜单、扩展图标。                | 浏览器访问 URL、系统分享菜单 (移动端 PWA)。      |
| **运行环境** | 仅限桌面端 Chrome 及其兼容浏览器。                | 全平台浏览器 (PC/iOS/Android)，支持安装至桌面。  |

## 2. 功能点详细对比

### 2.1 图片数据获取 (核心差异)

| 功能点               | Chrome 扩展端                                      | PWA 端                                                           |
| :------------------- | :------------------------------------------------- | :--------------------------------------------------------------- |
| **DOM 解析**         | **支持**。直接从 Twitter 页面 DOM 中提取图片 URL。 | **不支持**。受限于同源策略 (CORS)，无法访问 Twitter DOM。        |
| **URL 导入解析**     | 支持 (较少使用)。                                  | **核心功能**。通过后端 API (Cloudflare Workers) 抓取推文元数据。 |
| **右键菜单快速导入** | **支持**。右键点击图片即可直接进入拆图/拼图流程。  | **不支持**。网页端无法获取系统级右键菜单。                       |
| **页面实时注入**     | **支持**。在推文操作栏或图片上方注入“拼图”按钮。   | **不支持**。                                                     |

### 2.2 拆图与拼图功能

| 功能点           | Chrome 扩展端                         | PWA 端                                     |
| :--------------- | :------------------------------------ | :----------------------------------------- |
| **本地图片上传** | 支持。                                | 支持。                                     |
| **剪贴板粘贴**   | 支持。                                | 支持。                                     |
| **图片下载代理** | 通过 `background.js` 执行跨域 fetch。 | 通过后端 Worker 代理下载以绕过 CORS 限制。 |
| **图片处理能力** | 基于 Canvas，两端保持一致。           | 基于 Canvas，两端保持一致。                |

### 2.3 存储与配置

| 功能点            | Chrome 扩展端                               | PWA 端                                              |
| :---------------- | :------------------------------------------ | :-------------------------------------------------- |
| **配置同步**      | 使用 `chrome.storage.local`，持久化程度高。 | 使用 `localStorage`。                               |
| **国际化 (i18n)** | 使用 `chrome.i18n` 结合本地 JSON 消息文件。 | 模拟 `chrome.i18n` 行为，使用相同的 JSON 翻译文件。 |

## 3. 技术架构架构差异

### 3.1 Chrome 扩展端

- **Content Scripts**: 负责解析 Twitter 页面 DOM，监听节点变化 (`MutationObserver`)，注入 UI。
- **Background Script**: 充当网络代理，处理跨域图片下载，管理右键菜单。
- **UI Mounting**: 将 React 应用挂载到 Twitter 页面的影子 DOM (Shadow DOM) 中，防止样式冲突。

### 3.2 PWA 端

- **Backend API**: 依赖部署在 Cloudflare Workers 的后端脚本，通过模拟请求或爬取方式获取推文图片列表。
- **Standalone Runtime**: 作为独立的单页应用 (SPA) 运行，不依赖 Twitter 页面环境。
- **Service Worker**: 处理离线缓存和 PWA 资源加速。

## 4. 总结与建议

- **插件端** 优势在于**效率**。用户在浏览推特时可以“即看即拆”，流程极短。
- **PWA 端** 优势在于**兼容性**。用户只需复制推文链接即可在任何设备处理图片，且后端 API 的存在使得我们可以处理那些 DOM 解析困难的场景。

**后续优化方向：**

1. **PWA 端增强**：进一步优化移动端分享接入逻辑 (Web Share Target API)，实现“分享推文到 PWA”直接解析。
2. **API 共享**：插件端在 DOM 解析失败时，可降级使用 PWA 端的后端 API 进行解析。
