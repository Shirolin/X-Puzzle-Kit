# Chrome 插件商店上线流程指南

本文档详细记录将 `x-puzzle-kit` 发布到 Chrome Web Store (CWS) 的完整流程。

## 1. 准备工作 (Preparation)

### 1.1 开发者账号

- **注册**: 访问 [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/developer/dashboard)
- **费用**: 需要支付 **$5 美元** 的一次性注册费。
- **验证**: 可能需要验证邮箱。

### 1.2 必备素材 (Assets)

商店列表页需要以下视觉素材，请提前准备：

| 素材类型        | 尺寸及要求                   | 数量       | 说明                                                                                                  |
| :-------------- | :--------------------------- | :--------- | :---------------------------------------------------------------------------------------------------- |
| **应用图标**    | 128 x 128 px                 | 1张        | PNG 格式，透明背景，边缘留白。不要有阴影。                                                            |
| **商店图标**    | 16 x 16, 32 x 32, 48 x 48 px | 各1张      | 在 `manifest.json` 中定义，Extension 实际上传包内使用。                                               |
| **屏幕截图**    | 1280 x 800 px (推荐)         | 1-5张      | 展示核心功能。JPEG 或 24-bit PNG。<br>建议包含：<br>1. 拼图预览界面<br>2. 右键菜单操作<br>3. 设置页面 |
| **促销图 (小)** | 440 x 280 px                 | 1张        | **必须**。在商店搜索结果和推荐位显示。<br>设计要点：品牌Logo + 简短标语。                             |
| **促销图 (大)** | 920 x 680 px                 | 1张 (可选) | 用于大型推荐位，建议准备。                                                                            |
| **促销图 (宽)** | 1400 x 560 px                | 1张 (可选) | 顶部横幅，建议准备。                                                                                  |

### 1.3 文本资料

- **标题 (Name)**: `X-Puzzle-Kit` (已在 manifest 中定义，商店可覆盖)
- **摘要 (Summary)**: 简短描述，132 字符以内。例如：“一键拼接 Twitter 多图，还原高清大图体验。”
- **详细描述 (Description)**: 支持 Markdown 格式。详细介绍功能点、快捷键、隐私声明等。

### 1.4 隐私政策 (Privacy Policy)

- [ ] **URL**: 由于需要在 manifest 中声明 `host_permissions` (访问 x.com)，**必须**提供隐私政策链接。
- **内容**: 需明确声明“不收集用户数据”、“图片处理完全在本地进行”等。
- **托管**: 我们使用 GitHub Pages 托管，链接为：`https://Shirolin.github.io/X-Puzzle-Kit/`。
- **配置**: 参考本文档 "2. 配置 GitHub Pages" 章节确保页面可访问。

## 2. 打包构建 (Build & Package)

我们已经配置了自动化脚本。

1. **运行构建命令**:

   ```bash
   npm run package
   ```

   该命令会执行 `vite build` 并生成 ZIP 包。

2. **检查产物**:
   - 位置: `release/x-puzzle-kit-v1.0.2.zip`
   - **重要**: 上传给商店的是这个 **ZIP 文件**，而不是 `.crx` 文件。

## 3. 提交审核 (Submission)

1. 进入 [Developer Dashboard](https://chrome.google.com/webstore/developer/dashboard)。
2. 点击 **"New Item"** (新建项目)，上传 `release/xxxx.zip`。
3. **填写 "Store Listing" (商店详情)**:
   - 上传上述准备的图标、截图、促销图。
   - 填写多语言描述（如果有多语言需求）。
4. **填写 "Privacy" (隐私)**:
   - **Host Permissions**: 必须解释为何需要访问 `x.com`。
     - _理由示例_: "The extension needs access to x.com and twitter.com to detect image elements on the page and extract high-quality original image URLs for the stitching functionality. Processing happens locally."
   - **Remote Code**: 声明不使用远程代码 (Manifest V3 禁止)。
   - **Data Usage**: 勾选相关选项。核心由于我们是本地处理，大部分选 "No, I don't collect..."。
5. **发布 (Publish)**:
   - 提交审核。
   - 审核时长通常为 **24 - 48 小时**，首次发布可能稍长。

## 4. 常见拒审原因与对策

| 原因                           | 对策                                                                                                                     |
| :----------------------------- | :----------------------------------------------------------------------------------------------------------------------- |
| **权限过度 (Over-permission)** | 确保 `manifest.json` 中只申请了必要的权限。目前 `activeTab` + `host_permissions` 是合理的。                              |
| **描述误导**                   | 描述中不要堆砌关键词 (Keyword Stuffing)，如重复 "Twitter downloader"。                                                   |
| **功能无法测试**               | 如果功能需要登录 Twitter 才能用，可能需要给审核员提供测试账号（通常 Twitter 这种公开平台不需要，但若有特殊门槛则需要）。 |
| **单一用途**                   | 扩展必须有单一明确的用途。我们的功能很聚焦，这点没问题。                                                                 |

## 5. 后续维护

- **更新**: 修改代码 -> 增加 `package.json` 版本号 -> `npm run package` -> Dashboard点击 "Package" -> "Upload new package"。

## 6. 隐私权限理由文案 (Privacy Justification Copy-Paste)

在 Chrome Web Store 的 "Privacy" -> "Permissions" 标签页中，你需要为每个申请的权限填写理由。
请直接复制以下 **英文文案 (English)** 填入对应的文本框。

### 6.1 Host Permissions (x.com, twitter.com)

**Rationale (理由):**

> The extension needs to access the DOM of twitter.com and x.com to identify image elements (such as 2x2 grid images) within tweets. This allows the extension to extract the original high-resolution image URLs required for the image stitching and splitting functionality. All processing is done locally within the user's browser.

### 6.2 "downloads" Permission

**Rationale (理由):**

> The "downloads" permission is required to save the final stitched images or split image fragments to the user's local disk. The extension generates a unique filename based on the tweet metadata and triggers the download API to save the file.

### 6.3 "storage" Permission

**Rationale (理由):**

> The "storage" permission is used to save user preferences locally, such as the preferred file format (PNG/JPG), filename template settings, and theme preference (Light/Dark mode). No personal data is stored.

### 6.4 "contextMenus" Permission

**Rationale (理由):**

> The extension adds a "Split Image" item to the browser's context menu. This allows users to right-click on any image on a webpage to quickly initiate the image splitting tool without navigating away from their current view.

### 6.5 "activeTab" Permission

_(注：如果你的 manifest 包含了这个权限，通常用于在用户点击插件图标时临时获取权限。如果你主要依赖 Host Permissions，这个可能是可选的，但若申请了，请填写如下)_
**Rationale (理由):**

> The "activeTab" permission is used to grant the extension temporary access to the current tab when the user invokes the extension via the toolbar icon or keyboard shortcut, ensuring the extension only runs when explicitly triggered by the user.

## 7. 单一用途描述文案 (Single Purpose Description)

Chrome Web Store 要求每个插件必须有 **"Single Purpose" (单一用途)**。需要在 Publish 流程中描述你的插件主要为了解决什么问题。

### 英文描述建议 (可以直接使用)

**Option 1 (Focus on Stitching & Splitting):**

> The single purpose of this extension is to enhance image management on Twitter (X.com) by providing tools to stitch split images back together and split large images for better posting. It solves the fragmentation issue of Twitter's image grid layout, allowing users to save complete artworks or create standardized image grids directly from their browser.

**Option 2 (More concise):**

> This extension is dedicated to processing images on Twitter/X. It allows users to stitch multiple grid images into a single high-quality file and split large images into Twitter-friendly formats, streamlining the image saving and sharing workflow.

## 8. 附录：配置 GitHub Pages (Appendix: Setting up GitHub Pages)

为了使隐私政策链接生效，你需要手动在 GitHub 仓库中开启 Pages 服务。

1.  **打开仓库设置**: 进入 GitHub 仓库页面 -> 点击 **Settings**。
2.  **设置公开**: Slide down to **Danger Zone** -> Ensure repository is **Public** (Change visibility if needed).
3.  **进入 Pages 设置**: 点击左侧边栏的 **Pages**。
4.  **配置构建源**:
    - **Source**: Select "Deploy from a branch".
    - **Branch**: Select **`gh-pages`** branch (此分支由 Actions 自动创建，如果没有，请先运行一次 "Deploy Privacy Policy" workflow).
    - **Folder**: Keep as `/ (root)`.
5.  **保存**: Click **Save**.
6.  **验证**: Wait for deployment, then visit `https://Shirolin.github.io/X-Puzzle-Kit/` to verify.
